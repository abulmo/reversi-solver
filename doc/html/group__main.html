<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Othello Solver: Main Program Module</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>Main Program Module</h1><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__main.html#ga0">usage</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Print program usage.  <a href="#ga0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__main.html#ga1">main</a> (int argc, char **argv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Program main function.  <a href="#ga1"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The main function and a usage function explaining the program options are defined here. <hr><h2>Function Documentation</h2>
<a class="anchor" name="ga1" doxytag="solver.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Program main function. 
<p>
Read optional parameters and a script file name from the command line. Then loop through the positions provided in the script file, solving each one according to the chosen options. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>argc</em>&nbsp;</td><td>number of arguments. </td></tr>
    <tr><td valign=top><em>argv</em>&nbsp;</td><td>arguments. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>SUCCESS_EXIT or SUCCESS_FAILURE. </dd></dl>

<p>
<div class="fragment"><pre>02240 {
02241     <a class="code" href="structBoard.html">Board</a> board;
02242     <a class="code" href="structMove.html">Move</a> bestmove;
02243     <span class="keywordtype">char</span> *file_name = NULL, problem[256];
02244     FILE *file;
02245     clock_t t, T = 0;
02246     <span class="keywordtype">int</span> i, verbose = 0, mode = <a class="code" href="group__mac.html#gga59a134">EXACT_SCORE</a>;
02247     <span class="keywordtype">double</span> nodes = 0.0;
02248     <a class="code" href="structHashTable.html">HashTable</a> hash_table = {NULL, 0};
02249 <span class="preprocessor">#if COUNT_NODES &gt; 0</span>
02250 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *HEADER = <span class="stringliteral">"\n # |depth|score|   principal variation   |   time    | nodes (N)  | speed (N/s)"</span>;
02251     <span class="keyword">const</span> <span class="keywordtype">char</span> *SEPARATOR = <span class="stringliteral">"-------------------------------------------------------------------------------"</span>;
02252 <span class="preprocessor">#else</span>
02253 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *HEADER = <span class="stringliteral">"\n # |depth|score|   principal variation   |   time"</span>;
02254     <span class="keyword">const</span> <span class="keywordtype">char</span> *SEPARATOR = <span class="stringliteral">"-----------------------------------------------------"</span>;
02255 <span class="preprocessor">#endif</span>
02256 <span class="preprocessor"></span><span class="preprocessor">#ifdef _WIN32</span>
02257 <span class="preprocessor"></span>    HANDLE hthread;
02258     <span class="keywordtype">int</span> priority = THREAD_PRIORITY_NORMAL;
02259 <span class="preprocessor">#endif</span>
02260 <span class="preprocessor"></span>
02261     <span class="comment">/* parse arguments */</span>
02262     <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
02263         <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-vv"</span>) == 0) verbose = 2;
02264         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-v"</span>) == 0) verbose = 1;
02265         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-wdl"</span>) == 0) mode = <a class="code" href="group__mac.html#gga59a135">WDL_SCORE</a>;
02266         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-wd"</span>) == 0) mode = <a class="code" href="group__mac.html#gga59a136">WD_SCORE</a>;
02267         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-dl"</span>) == 0) mode = <a class="code" href="group__mac.html#gga59a137">DL_SCORE</a>;
02268         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-h"</span>) == 0 &amp;&amp; i + 1 &lt; argc)
02269             <a class="code" href="group__hash.html#ga1">hash_init</a>(&amp;hash_table, atoi(argv[++i]));
02270 <span class="preprocessor">#ifdef _WIN32</span>
02271 <span class="preprocessor"></span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-critical"</span>) == 0)
02272             priority = THREAD_PRIORITY_TIME_CRITICAL;
02273         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-idle"</span>) == 0)
02274             priority = THREAD_PRIORITY_IDLE;
02275         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[i], <span class="stringliteral">"-normal"</span>) == 0)
02276             priority = THREAD_PRIORITY_NORMAL;
02277 <span class="preprocessor">#endif</span>
02278 <span class="preprocessor"></span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_name == NULL) file_name = argv[i];
02279         <span class="keywordflow">else</span> <a class="code" href="group__main.html#ga0">usage</a>();
02280     }
02281 
02282     <span class="comment">/* open script file */</span>
02283     <span class="keywordflow">if</span> (file_name == NULL) <a class="code" href="group__main.html#ga0">usage</a>();
02284     file = fopen(file_name, <span class="stringliteral">"r"</span>);
02285     <span class="keywordflow">if</span> (file == NULL) {
02286         fprintf(stderr, <span class="stringliteral">"solver: cannot open script file %s\n"</span>, file_name);
02287         exit(EXIT_FAILURE);
02288     }
02289 
02290     <span class="comment">/* priority control for win32 systems */</span>
02291 <span class="preprocessor">#ifdef _WIN32</span>
02292 <span class="preprocessor"></span>    hthread = GetCurrentThread();
02293     <span class="keywordflow">if</span> (!SetThreadPriority(hthread, priority)) {
02294         fputs(<span class="stringliteral">"solver: cannot change the thread priority\n"</span>, stderr);
02295     }
02296 <span class="preprocessor">#endif</span>
02297 <span class="preprocessor"></span>
02298     <span class="comment">/* loop through problems */</span>
02299     <span class="keywordflow">if</span> (verbose == 1) {
02300         puts(HEADER);
02301         puts(SEPARATOR);
02302     }
02303     <span class="keywordflow">for</span> (i = 0; fgets(problem, 256, file) ; i++) {
02304         <span class="keywordflow">if</span> (*problem == <span class="charliteral">'%'</span>) <span class="keywordflow">continue</span>;
02305         <a class="code" href="group__board.html#ga0">board_set</a>(&amp;board, problem);
02306         <span class="keywordflow">if</span> (verbose == 2) {
02307             <a class="code" href="group__board.html#ga12">board_print</a>(&amp;board, stdout);
02308             puts(HEADER);
02309             puts(SEPARATOR);
02310         }
02311         t = clock();
02312 <span class="preprocessor">#if USE_HASH_TABLE</span>
02313 <span class="preprocessor"></span>        <a class="code" href="group__hash.html#ga2">hash_clear</a>(&amp;hash_table);
02314 <span class="preprocessor">#endif</span>
02315 <span class="preprocessor"></span>        <a class="code" href="group__search.html#ga7">solve</a>(&amp;board,&amp;hash_table,mode,&amp;bestmove);
02316         t = clock() - t;
02317         T += t;
02318         nodes += board.<a class="code" href="structBoard.html#o4">n_nodes</a>;
02319         <span class="keywordflow">if</span> (verbose) {
02320             printf(<span class="stringliteral">"%3d|"</span>, i + 1);
02321             printf(<span class="stringliteral">"  %2d |"</span>, board.<a class="code" href="structBoard.html#o3">n_empties</a>);
02322             printf(<span class="stringliteral">" %+03d | "</span>, bestmove.<a class="code" href="structMove.html#o2">score</a>);
02323             <span class="keywordflow">if</span> (hash_table.<a class="code" href="structHashTable.html#o1">hash_mask</a> != 0) {
02324                 <a class="code" href="group__move.html#ga1">line_print</a>(&amp;board, &amp;hash_table, 8, stdout);
02325             } <span class="keywordflow">else</span> {
02326                 <a class="code" href="group__move.html#ga0">move_print</a>(*bestmove.<a class="code" href="structMove.html#o0">position</a>, board.<a class="code" href="structBoard.html#o1">player</a>, stdout);
02327                 printf(<span class="stringliteral">" -- -- -- -- -- -- -- "</span>);
02328             }
02329             printf(<span class="stringliteral">"| %d:%02d:%02d.%1d "</span>, <a class="code" href="group__mac.html#ga52">TICK_TO_H</a>(t), <a class="code" href="group__mac.html#ga53">TICK_TO_M</a>(t), <a class="code" href="group__mac.html#ga54">TICK_TO_S</a>(t), <a class="code" href="group__mac.html#ga55">TICK_TO_DS</a>(t));
02330 <span class="preprocessor">#if COUNT_NODES &gt; 0</span>
02331 <span class="preprocessor"></span>            printf(<span class="stringliteral">"|%11.0f |"</span>, board.<a class="code" href="structBoard.html#o4">n_nodes</a>);
02332             <span class="keywordflow">if</span> (t &gt; 0) printf(<span class="stringliteral">" %9.0f"</span>, board.<a class="code" href="structBoard.html#o4">n_nodes</a> / t * CLOCKS_PER_SEC);
02333 <span class="preprocessor">#endif</span>
02334 <span class="preprocessor"></span>            putchar(<span class="charliteral">'\n'</span>);
02335             <span class="keywordflow">if</span> (verbose == 2) putchar(<span class="charliteral">'\n'</span>);
02336             fflush(stdout);
02337         }
02338 <span class="preprocessor">#ifdef _WIN32</span>
02339 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (priority == THREAD_PRIORITY_TIME_CRITICAL) {
02340             Sleep(100);
02341         }
02342 <span class="preprocessor">#endif</span>
02343 <span class="preprocessor"></span>    }
02344     <span class="keywordflow">if</span> (verbose) puts(SEPARATOR);
02345 <span class="preprocessor">#if COUNT_NODES &gt; 0</span>
02346 <span class="preprocessor"></span>    printf(<span class="stringliteral">"%.30s : %.0f nodes in "</span>,file_name, nodes);
02347     printf(<span class="stringliteral">"%d:%02d:%02d.%1d"</span>,
02348         <a class="code" href="group__mac.html#ga52">TICK_TO_H</a>(T), <a class="code" href="group__mac.html#ga53">TICK_TO_M</a>(T), <a class="code" href="group__mac.html#ga54">TICK_TO_S</a>(T), <a class="code" href="group__mac.html#ga55">TICK_TO_DS</a>(T));
02349     <span class="keywordflow">if</span> (T &gt; 0) printf(<span class="stringliteral">" %.0f nodes/s."</span>, nodes * CLOCKS_PER_SEC / T);
02350     printf(<span class="stringliteral">"\n\n"</span>);
02351 <span class="preprocessor">#else</span>
02352 <span class="preprocessor"></span>    printf(<span class="stringliteral">"%.30s : %d:%02d:%02d.%1d\n\n"</span>,
02353         file_name, <a class="code" href="group__mac.html#ga52">TICK_TO_H</a>(T), <a class="code" href="group__mac.html#ga53">TICK_TO_M</a>(T), <a class="code" href="group__mac.html#ga54">TICK_TO_S</a>(T), <a class="code" href="group__mac.html#ga55">TICK_TO_DS</a>(T));
02354 <span class="preprocessor">#endif</span>
02355 <span class="preprocessor"></span>    <span class="comment">/* close files &amp; free allocated data */</span>
02356     fclose(file);
02357     <a class="code" href="group__hash.html#ga3">hash_free</a>(&amp;hash_table);
02358 
02359     <span class="keywordflow">return</span> EXIT_SUCCESS;
02360 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga0" doxytag="solver.c::usage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void usage </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Print program usage. 
<p>
Explain the program command line parameters. 
<p>
<div class="fragment"><pre>02209 {
02210     fprintf(stderr,<span class="stringliteral">"solver [options] &lt;script_file&gt;\n"</span>);
02211     fprintf(stderr,<span class="stringliteral">"\nSolve a set of othello engdame problems\n"</span>);
02212     fprintf(stderr,<span class="stringliteral">"\nOptions:\n"</span>);
02213     fprintf(stderr,<span class="stringliteral">"  -v            verbose mode.\n"</span>);
02214     fprintf(stderr,<span class="stringliteral">"  -vv           very verbose mode.\n"</span>);
02215     fprintf(stderr,<span class="stringliteral">"  -wdl          search for win/draw/loss.\n"</span>);
02216     fprintf(stderr,<span class="stringliteral">"  -wd           search for win/(draw-loss).\n"</span>);
02217     fprintf(stderr,<span class="stringliteral">"  -dl           search for (win-draw)/loss.\n"</span>);
02218     fprintf(stderr,<span class="stringliteral">"  -h &lt;nbits&gt;    set hash table size.\n"</span>);
02219 <span class="preprocessor">#ifdef _WIN32</span>
02220 <span class="preprocessor"></span>    fprintf(stderr,<span class="stringliteral">"  -critical     run at critical time priority.\n"</span>);
02221     fprintf(stderr,<span class="stringliteral">"  -normal       run at normal time priority (default).\n"</span>);
02222     fprintf(stderr,<span class="stringliteral">"  -idle         run at idle time priority.\n"</span>);
02223 <span class="preprocessor">#endif</span>
02224 <span class="preprocessor"></span>    fprintf(stderr,<span class="stringliteral">"\nExample:\n"</span>);
02225     fprintf(stderr,<span class="stringliteral">"solver -v -h 20 fforum-20-39.scr\n\n"</span>);
02226     exit(EXIT_FAILURE);
02227 }
</pre></div>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 12 19:31:52 2004 for Othello Solver by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
