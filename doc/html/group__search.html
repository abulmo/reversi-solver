<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Othello Solver: Search module</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>Search module</h1><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga0">board_get_final_score</a> (const <a class="el" href="structBoard.html">Board</a> *board)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the final score.  <a href="#ga0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga1">board_get_final_score_0</a> (const <a class="el" href="structBoard.html">Board</a> *board)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the final score.  <a href="#ga1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga2">board_get_final_score_1</a> (<a class="el" href="structBoard.html">Board</a> *board)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the final score.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga3">board_get_final_score_2</a> (<a class="el" href="structBoard.html">Board</a> *board, int alpha, int beta, int passed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the final score.  <a href="#ga3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga4">alphabeta_shallow</a> (<a class="el" href="structBoard.html">Board</a> *board, int alpha, int beta, int passed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Evaluate a position using a shallow Alphabeta.  <a href="#ga4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga5">PVS_deep</a> (<a class="el" href="structBoard.html">Board</a> *board, <a class="el" href="structHashTable.html">HashTable</a> *hash_table, int alpha, int beta, int passed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Evaluate a position with a deep Principal Variation Search algorithm.  <a href="#ga5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga6">PVS_root</a> (<a class="el" href="structBoard.html">Board</a> *board, <a class="el" href="structHashTable.html">HashTable</a> *hash_table, int alpha, int beta, <a class="el" href="structMoveList.html">MoveList</a> *movelist)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Principal Variation Search algorithm at the root of the tree.  <a href="#ga6"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__search.html#ga7">solve</a> (<a class="el" href="structBoard.html">Board</a> *board, <a class="el" href="structHashTable.html">HashTable</a> *hash_table, int mode, <a class="el" href="structMove.html">Move</a> *bestmove)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Search the bestmove of a given board.  <a href="#ga7"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Functions that evaluate a board with different methods depending on the position in the tree search and/or that finds the best move of a given board.<p>
At the end of the game, some trivial functions are used to compute the score. Optimization here is reached by maintaining a disc number record that is updated each time a move is made. At the end of the game, computing the score consists only to a simple substraction. For further optimization, the last move is not made and only the number of flipped discs is evaluated. Special and optimized functions are used when one or two empty squares remain on the board, in order to speed up the search.<p>
The search of the best move is driven with the Principal Variation Search algorithm (PVS) [1], an enhanced variation of the alphabeta algorithm. The alphabeta algorithm is known to visit less nodes when the alphabeta window is reduced. PVS takes this property into account. From a set of sibling nodes, the first node is searched using a plain alpha beta window. Then the sibling nodes are only searched with minimal windows (where beta = alpha + 1), just to refute the best (first) score. In rare cases the first move is actually refuted, then the current move is re-searched a second time in order to determinate its score more accurately. On highly ordered tree, very few re-searches will be done. Moreover, thanks to the hash table, a second search is usually faster than a first search. So the seldom and fast re-searches will not impact too much the benefit of using minimal windows. Aspiration windows have been added as another improvement, so that even the first search is done with a reduced window. During the 1990s, several re-re-search algorithm based on null-window alphabeta have been proposed : SSS*ab [2], Dual*ab[2], NegaC*[3], MDT[2], negascout[4]. Some (unpublished) experimental tests I made with them did not show any significant improvement compare to the PVS algorithm with aspiration-windows used here.<p>
To be efficient PVS need highly ordered tree. The following ordering have been made :<ul>
<li>fixed square ordering : square usually leading to a good move are visited first, ie from corner squares to X and C squares.</li><li>most stable ordering : a crude evaluation of stability at the corner (corner, X and C squares) to order the moves.</li><li>fast first ordering : the moves leading to the most reduced mobility for the opponent are played first.</li><li>best move previously found : If the position have been previously searched, the best move that was found is replayed as the first move.</li></ul>
<p>
<ol>
<li>Campbell MS &amp; Marsland TA (1983) A Comparison of Minimax Trees Search Algorithms. Artificial Intelligence, 20, pp. 347-367.</li><li>Plaat A. et al. (1996) Best-First Fixed Depth Minimax Algorithms. Artificial Intelligence, 84, pp. 255-293.</li><li>Weill JC. (1992) Experiments With The NegaC* Search. An alternative for Othello Endgame Search. ICCA journal, 15(1), pp. 3-7.</li><li>Reinsfeld A. (1983) An Improvement Of the Scout Tree-Search Algorithm. ICCA journal, 6(4), pp. 4-14. </li></ol>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga4" doxytag="solver.c::alphabeta_shallow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int alphabeta_shallow </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>board</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>beta</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>passed</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Evaluate a position using a shallow Alphabeta. 
<p>
This function is used when there are few empty squares on the board. Here, optimizations are in favour of speed instead of efficiency. A simple alphabeta is used because of the low branching factor that makes PVS less efficient. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
    <tr><td valign=top><em>alpha</em>&nbsp;</td><td>lower bound. </td></tr>
    <tr><td valign=top><em>beta</em>&nbsp;</td><td>upper bound. </td></tr>
    <tr><td valign=top><em>passed</em>&nbsp;</td><td>a flag indicating if previous move was a pass. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01822 {
01823     <span class="keyword">const</span> <span class="keywordtype">char</span> p = board-&gt;<a class="code" href="structBoard.html#o1">player</a>;
01824     <span class="keyword">const</span> <span class="keywordtype">char</span> o = <a class="code" href="group__mac.html#ga50">OPPONENT</a>(p);
01825     <span class="keywordtype">int</span> score, bestscore = -<a class="code" href="group__mac.html#ga21">INF_SCORE</a>;
01826     <a class="code" href="structSquareList.html">SquareList</a> *empties;
01827     <a class="code" href="structMove.html">Move</a> move;
01828 
01829 <span class="preprocessor">#if PLAY_ODD_SQUARE_FIRST</span>
01830 <span class="preprocessor"></span>    <span class="keywordtype">int</span> parity;
01831     <span class="keywordflow">for</span> (parity = 1; parity &gt;= 0; parity--) {
01832         <span class="keywordflow">for</span> (empties = board-&gt;<a class="code" href="structBoard.html#o7">empties</a>-&gt;<a class="code" href="structSquareList.html#o2">next</a>; empties-&gt;<a class="code" href="structSquareList.html#o0">position</a> != <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>; empties = empties-&gt;<a class="code" href="structSquareList.html#o2">next</a>) {
01833             <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o6">parity</a>[<a class="code" href="group__mac.html#ga1">QUADRANT_ID</a>[empties-&gt;<a class="code" href="structSquareList.html#o0">position</a>]] == parity
01834              &amp;&amp; <a class="code" href="group__board.html#ga3">board_do_flip</a>(board, empties-&gt;<a class="code" href="structSquareList.html#o0">position</a>, &amp;move)) {
01835 <span class="preprocessor">#else</span>
01836 <span class="preprocessor"></span>        {
01837         <span class="keywordflow">for</span> (empties = board-&gt;<a class="code" href="structBoard.html#o7">empties</a>-&gt;<a class="code" href="structSquareList.html#o2">next</a>; empties-&gt;<a class="code" href="structSquareList.html#o0">position</a> != <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>; empties = empties-&gt;<a class="code" href="structSquareList.html#o2">next</a>) {
01838             <span class="keywordflow">if</span> (<a class="code" href="group__board.html#ga3">board_do_flip</a>(board, empties-&gt;<a class="code" href="structSquareList.html#o0">position</a>, &amp;move)) {
01839 <span class="preprocessor">#endif</span>
01840 <span class="preprocessor"></span>                <a class="code" href="group__mac.html#ga38">BOARD_UPDATE_PLAYER</a>(board);
01841                 <a class="code" href="group__mac.html#ga40">BOARD_UPDATE_DISCS</a>(board, move.<a class="code" href="structMove.html#o1">n</a>);
01842                 <a class="code" href="group__mac.html#ga42">BOARD_UPDATE_PARITY</a>(board, *move.<a class="code" href="structMove.html#o0">position</a>);
01843                 <a class="code" href="group__mac.html#ga44">BOARD_UPDATE_EMPTIES</a>(board, empties, *move.<a class="code" href="structMove.html#o0">position</a>);
01844                 <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 2) {
01845                     score = -<a class="code" href="group__search.html#ga3">board_get_final_score_2</a>(board, -beta, -alpha, 0);
01846                 } <span class="keywordflow">else</span> {
01847                     score = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -beta, -alpha, 0);
01848                 }
01849                 <a class="code" href="group__mac.html#ga37">BOARD_RESTORE_SQUARE</a>(board, &amp;move);
01850                 <a class="code" href="group__mac.html#ga39">BOARD_RESTORE_PLAYER</a>(board);
01851                 <a class="code" href="group__mac.html#ga41">BOARD_RESTORE_DISCS</a>(board, move.<a class="code" href="structMove.html#o1">n</a>);
01852                 <a class="code" href="group__mac.html#ga43">BOARD_RESTORE_PARITY</a>(board, *move.<a class="code" href="structMove.html#o0">position</a>);
01853                 <a class="code" href="group__mac.html#ga45">BOARD_RESTORE_EMPTIES</a>(board, empties, *move.<a class="code" href="structMove.html#o0">position</a>);
01854                 <span class="keywordflow">if</span> (score &gt; bestscore) {
01855                     bestscore = score;
01856                     <span class="keywordflow">if</span> (bestscore &gt; alpha) {
01857                         alpha = bestscore;
01858                         <span class="keywordflow">if</span> (alpha &gt;= beta) <span class="keywordflow">return</span> bestscore;
01859                     }
01860                 }
01861             }
01862         }
01863     }
01864 
01865     <span class="comment">/* no move */</span>
01866     <span class="keywordflow">if</span> (bestscore == -<a class="code" href="group__mac.html#ga21">INF_SCORE</a>) {
01867         <span class="keywordflow">if</span> (passed) { <span class="comment">/* game over */</span>
01868             <a class="code" href="group__mac.html#ga28">BOARD_CORRECT_TERMINAL_NODES</a>();
01869             bestscore = <a class="code" href="group__search.html#ga0">board_get_final_score</a>(board);
01870         } <span class="keywordflow">else</span> { <span class="comment">/* pass */</span>
01871             <a class="code" href="group__mac.html#ga38">BOARD_UPDATE_PLAYER</a>(board);
01872             <a class="code" href="group__mac.html#ga26">BOARD_UPDATE_INTERNAL_NODES</a>();
01873             bestscore = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -beta, -alpha, 1);
01874             <a class="code" href="group__mac.html#ga39">BOARD_RESTORE_PLAYER</a>(board);
01875         }
01876     }
01877 
01878     <span class="keywordflow">return</span> bestscore;
01879 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga0" doxytag="solver.c::board_get_final_score" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int board_get_final_score </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>board</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the final score. 
<p>
Get the final score, when no move can be made. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01680 {
01681     <span class="keyword">const</span> <span class="keywordtype">int</span> p = board-&gt;<a class="code" href="structBoard.html#o1">player</a>;
01682     <span class="keyword">const</span> <span class="keywordtype">int</span> o = <a class="code" href="group__mac.html#ga50">OPPONENT</a>(p);
01683     <span class="keywordtype">int</span> score = board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[p] - board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[o];
01684 
01685     <span class="keywordflow">if</span> (score &lt; 0) score -= board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a>;
01686     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &gt; 0) score += board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a>;
01687 
01688     <span class="keywordflow">return</span> score;
01689 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga1" doxytag="solver.c::board_get_final_score_0" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int board_get_final_score_0 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>board</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the final score. 
<p>
Get the final score, when the board is full. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01699 {
01700     <span class="keyword">const</span> <span class="keywordtype">int</span> p = board-&gt;<a class="code" href="structBoard.html#o1">player</a>;
01701     <span class="keyword">const</span> <span class="keywordtype">int</span> o = <a class="code" href="group__mac.html#ga50">OPPONENT</a>(p);
01702     <span class="keywordtype">int</span> score = board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[p] - board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[o];
01703 
01704     <span class="keywordflow">return</span> score;
01705 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="solver.c::board_get_final_score_1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int board_get_final_score_1 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>board</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the final score. 
<p>
Get the final score, when 1 empty square remains. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01715 {
01716     <span class="keyword">const</span> <span class="keywordtype">int</span> p = board-&gt;<a class="code" href="structBoard.html#o1">player</a>;
01717     <span class="keyword">const</span> <span class="keywordtype">int</span> o = <a class="code" href="group__mac.html#ga50">OPPONENT</a>(p);
01718     <span class="keywordtype">int</span> score = board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[p] - board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[o];
01719     <span class="keywordtype">int</span> n_flips;
01720     <span class="keyword">const</span> <span class="keywordtype">int</span> x = board-&gt;<a class="code" href="structBoard.html#o7">empties</a>-&gt;<a class="code" href="structSquareList.html#o2">next</a>-&gt;<a class="code" href="structSquareList.html#o0">position</a>;
01721 
01722     <span class="keywordflow">if</span> ((n_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x, p)) &gt; 0) {
01723         score += 2 * n_flips + 1;
01724         <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01725     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((n_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x, o)) &gt; 0) {
01726         score -= 2 * n_flips + 1;
01727         <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01728     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &lt; 0) score--;
01729     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &gt; 0) score++;
01730 
01731     <span class="keywordflow">return</span> score;
01732 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="solver.c::board_get_final_score_2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int board_get_final_score_2 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>board</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>beta</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>passed</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the final score. 
<p>
Get the final score, when 2 empty squares remain. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>the board to evaluate. </td></tr>
    <tr><td valign=top><em>alpha</em>&nbsp;</td><td>upper score value. </td></tr>
    <tr><td valign=top><em>beta</em>&nbsp;</td><td>lower score value. </td></tr>
    <tr><td valign=top><em>passed</em>&nbsp;</td><td>a flag indicating if previous move was a pass. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01745 {
01746     <span class="keyword">const</span> <span class="keywordtype">char</span> p = board-&gt;<a class="code" href="structBoard.html#o1">player</a>;
01747     <span class="keyword">const</span> <span class="keywordtype">char</span> o = <a class="code" href="group__mac.html#ga50">OPPONENT</a>(p);
01748     <a class="code" href="structSquareList.html">SquareList</a> *empties = board-&gt;<a class="code" href="structBoard.html#o7">empties</a>-&gt;<a class="code" href="structSquareList.html#o2">next</a>;
01749     <span class="keywordtype">int</span> x1 = empties-&gt;<a class="code" href="structSquareList.html#o0">position</a>;
01750     <span class="keywordtype">int</span> x2 = empties-&gt;<a class="code" href="structSquareList.html#o2">next</a>-&gt;<a class="code" href="structSquareList.html#o0">position</a>;
01751     <span class="keywordtype">int</span> score, bestscore, n1_flips, n2_flips, diff_discs;
01752     <a class="code" href="structMove.html">Move</a> move;
01753 
01754     diff_discs = board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[(<span class="keywordtype">int</span>)p] - board-&gt;<a class="code" href="structBoard.html#o2">n_discs</a>[(<span class="keywordtype">int</span>)o];
01755     bestscore = -<a class="code" href="group__mac.html#ga21">INF_SCORE</a>;
01756 
01757     <span class="comment">/* try to play on the first available square */</span>
01758     <span class="keywordflow">if</span> ((n1_flips = <a class="code" href="group__board.html#ga3">board_do_flip</a>(board, x1, &amp;move)) &gt; 0) {
01759         <span class="keywordflow">if</span> ((n2_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x2, o)) &gt; 0) {
01760             bestscore = diff_discs + 2 * (n1_flips - n2_flips);
01761             <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01762         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((n2_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x2, p)) &gt; 0) {
01763             bestscore = diff_discs + 2 * (n1_flips + n2_flips) + 2;
01764             <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01765         } <span class="keywordflow">else</span> {
01766             bestscore = diff_discs + 2 * n1_flips + 1;
01767             <span class="keywordflow">if</span> (bestscore &gt; 0) bestscore++;
01768             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bestscore &lt; 0) bestscore--;
01769         }
01770         <a class="code" href="group__mac.html#ga37">BOARD_RESTORE_SQUARE</a>(board, &amp;move);
01771         <a class="code" href="group__mac.html#ga39">BOARD_RESTORE_PLAYER</a>(board);
01772     }
01773     <span class="comment">/* if needed, try to play on the second &amp; last available square */</span>
01774     <span class="keywordflow">if</span> (bestscore &lt; beta &amp;&amp; (n1_flips = board_do_flip(board, x2, &amp;move)) &gt; 0) {
01775         <span class="keywordflow">if</span> ((n2_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x1, o)) &gt; 0) {
01776             score = diff_discs + 2 * (n1_flips - n2_flips);
01777             <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01778         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((n2_flips = <a class="code" href="group__board.html#ga2">board_count_flips</a>(board, x1, p)) &gt; 0) {
01779             score = diff_discs + 2 * (n1_flips + n2_flips) + 2;
01780             <a class="code" href="group__mac.html#ga27">BOARD_UPDATE_TERMINAL_NODES</a>();
01781         } <span class="keywordflow">else</span> {
01782             score = diff_discs + 2 * n1_flips + 1;
01783             <span class="keywordflow">if</span> (score &gt; 0) score++;
01784             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &lt; 0) score--;
01785         }
01786         <a class="code" href="group__mac.html#ga37">BOARD_RESTORE_SQUARE</a>(board, &amp;move);
01787         <a class="code" href="group__mac.html#ga39">BOARD_RESTORE_PLAYER</a>(board);
01788         <span class="keywordflow">if</span> (score &gt; bestscore) bestscore = score;
01789     }
01790     <span class="comment">/* if no move were available */</span>
01791     <span class="keywordflow">if</span> (bestscore == -<a class="code" href="group__mac.html#ga21">INF_SCORE</a>) {
01792         <span class="keywordflow">if</span> (passed) { <span class="comment">/* game is over */</span>
01793             <a class="code" href="group__mac.html#ga28">BOARD_CORRECT_TERMINAL_NODES</a>();
01794             bestscore = diff_discs;
01795             <span class="keywordflow">if</span> (bestscore &gt; 0) bestscore += 2;
01796             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bestscore &lt; 0) bestscore -= 2;
01797         } <span class="keywordflow">else</span> { <span class="comment">/* pass... */</span>
01798             <a class="code" href="group__mac.html#ga38">BOARD_UPDATE_PLAYER</a>(board);
01799             <a class="code" href="group__mac.html#ga26">BOARD_UPDATE_INTERNAL_NODES</a>();
01800             bestscore = -<a class="code" href="group__search.html#ga3">board_get_final_score_2</a>(board, -beta, -alpha, 1);
01801             <a class="code" href="group__mac.html#ga39">BOARD_RESTORE_PLAYER</a>(board);
01802         }
01803     }
01804 
01805     <span class="keywordflow">return</span> bestscore;
01806 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga5" doxytag="solver.c::PVS_deep" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int PVS_deep </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>board</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structHashTable.html">HashTable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hash_table</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>beta</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>passed</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Evaluate a position with a deep Principal Variation Search algorithm. 
<p>
This function is used when there are still many empty squares on the board. <a class="el" href="structMove.html">Move</a> ordering, hash table cutoff, enhanced transposition cutoff, etc. are used in order to diminish the size of the tree to analyse, but at the expense of a slower speed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
    <tr><td valign=top><em>hash_table</em>&nbsp;</td><td>hash_table. </td></tr>
    <tr><td valign=top><em>alpha</em>&nbsp;</td><td>lower bound. </td></tr>
    <tr><td valign=top><em>beta</em>&nbsp;</td><td>upper bound. </td></tr>
    <tr><td valign=top><em>passed</em>&nbsp;</td><td>a flag indicating if previous move was a pass. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the final score, as a disc difference. </dd></dl>

<p>
<div class="fragment"><pre>01897 {
01898     <span class="keywordtype">int</span> score, bestscore, lower, upper, bestmove;
01899     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hash_lock, hash_index;
01900     <a class="code" href="structMoveList.html">MoveList</a> movelist[<a class="code" href="group__mac.html#ga23">MAX_MOVE</a> + 2], *iter;
01901     <a class="code" href="structMove.html">Move</a> *move;
01902     <a class="code" href="structHash.html">Hash</a> *hash;
01903     <a class="code" href="structHashEntry.html">HashEntry</a> *hash_entry;
01904 
01905     bestmove = <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>;
01906     lower = alpha;
01907     upper = beta;
01908     <span class="comment">/* transposition cutoff ? */</span>
01909 <span class="preprocessor">#if USE_HASH_TABLE</span>
01910 <span class="preprocessor"></span>    hash = <a class="code" href="group__hash.html#ga5">hash_get</a>(hash_table, board);
01911     <span class="keywordflow">if</span> (hash != NULL) {
01912         <span class="keywordflow">if</span> (upper &gt; hash-&gt;<a class="code" href="structHash.html#o2">upper</a>) {
01913             upper = hash-&gt;<a class="code" href="structHash.html#o2">upper</a>;
01914             <span class="keywordflow">if</span> (upper &lt;= lower) <span class="keywordflow">return</span> upper;
01915         }
01916         <span class="keywordflow">if</span> (lower &lt; hash-&gt;<a class="code" href="structHash.html#o1">lower</a>) {
01917             lower = hash-&gt;<a class="code" href="structHash.html#o1">lower</a>;
01918             <span class="keywordflow">if</span> (lower &gt;= upper) <span class="keywordflow">return</span> lower;
01919         }
01920         bestmove = hash-&gt;<a class="code" href="structHash.html#o3">move</a>;
01921     }
01922 <span class="preprocessor">#endif</span>
01923 <span class="preprocessor"></span>    <a class="code" href="group__board.html#ga9">board_get_movelist</a>(board, movelist);
01924     <span class="keywordflow">if</span> (movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a> == NULL) {
01925         <span class="keywordflow">if</span> (passed) {
01926             <a class="code" href="group__mac.html#ga28">BOARD_CORRECT_TERMINAL_NODES</a>();
01927             alpha = -(beta = +<a class="code" href="group__mac.html#ga21">INF_SCORE</a>);
01928             bestscore = <a class="code" href="group__search.html#ga0">board_get_final_score</a>(board);
01929             bestmove = <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>;
01930         } <span class="keywordflow">else</span> {
01931             <a class="code" href="group__board.html#ga7">board_update_pass</a>(board);
01932             bestscore = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -lower, 1);
01933             bestmove = <a class="code" href="group__mac.html#gga56a57">PASS</a>;
01934             <a class="code" href="group__board.html#ga8">board_restore_pass</a>(board);
01935         }
01936     } <span class="keywordflow">else</span> {
01937         <span class="comment">/* enhanced transposition cutoff */</span>
01938 <span class="preprocessor">#if USE_ENHANCED_TRANSPOSITION_CUTOFF</span>
01939 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &gt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a> &amp;&amp;
01940             <a class="code" href="group__mac.html#ga51">HASH_TABLE_OK</a>(hash_table)) {
01941             <span class="keywordflow">if</span> (bestmove != <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>) <a class="code" href="group__move.html#ga2">movelist_sort_bestmove</a>(movelist, bestmove);
01942             <span class="keywordflow">for</span> (iter = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>; iter != NULL; iter = iter-&gt;<a class="code" href="structMoveList.html#o1">next</a>) {
01943                 move = &amp;(iter-&gt;<a class="code" href="structMoveList.html#o0">move</a>);
01944                 hash_index = (board-&gt;<a class="code" href="structBoard.html#o5">hash_code</a>[0] ^ move-&gt;<a class="code" href="structMove.html#o3">hash_code</a>[0]);
01945                 hash_lock = (board-&gt;<a class="code" href="structBoard.html#o5">hash_code</a>[1] ^ move-&gt;<a class="code" href="structMove.html#o3">hash_code</a>[1]);
01946                 hash_entry = hash_table-&gt;<a class="code" href="structHashTable.html#o0">hash_entry</a> + hash_index;
01947                 <a class="code" href="group__mac.html#ga29">BOARD_UPDATE_ALL_NODES</a>();
01948                 <span class="keywordflow">if</span> (hash_entry-&gt;<a class="code" href="structHashEntry.html#o0">deepest</a>.<a class="code" href="structHash.html#o0">lock</a> ==  hash_lock &amp;&amp; -hash_entry-&gt;<a class="code" href="structHashEntry.html#o0">deepest</a>.<a class="code" href="structHash.html#o2">upper</a> &gt;= upper)
01949                     <span class="keywordflow">return</span> -hash_entry-&gt;<a class="code" href="structHashEntry.html#o0">deepest</a>.<a class="code" href="structHash.html#o2">upper</a>;
01950                 <span class="keywordflow">if</span> (hash_entry-&gt;<a class="code" href="structHashEntry.html#o1">newest</a>.<a class="code" href="structHash.html#o0">lock</a> ==  hash_lock &amp;&amp; -hash_entry-&gt;<a class="code" href="structHashEntry.html#o1">newest</a>.<a class="code" href="structHash.html#o2">upper</a> &gt;= upper)
01951                     <span class="keywordflow">return</span> -hash_entry-&gt;<a class="code" href="structHashEntry.html#o1">newest</a>.<a class="code" href="structHash.html#o2">upper</a>;
01952             }
01953         }
01954 <span class="preprocessor">#endif</span>
01955 <span class="preprocessor"></span>        <span class="comment">/* move sorting */</span>
01956 <span class="preprocessor">#if PLAY_FAST_SUBTREE_FIRST</span>
01957 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &gt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>)
01958             <a class="code" href="group__move.html#ga3">movelist_sort_fastfirst</a>(movelist, board);
01959 <span class="preprocessor">#endif</span>
01960 <span class="preprocessor"></span><span class="preprocessor">#if PLAY_BEST_MOVE_IN_MEMORY_FIRST</span>
01961 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (bestmove != <a class="code" href="group__mac.html#gga56a56">NOMOVE</a> &amp;&amp; bestmove != *movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o0">position</a>)
01962             <a class="code" href="group__move.html#ga2">movelist_sort_bestmove</a>(movelist, bestmove);
01963 <span class="preprocessor">#endif</span>
01964 <span class="preprocessor"></span>
01965         <span class="comment">/* first move */</span>
01966         iter = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>;
01967         move = &amp;(iter-&gt;<a class="code" href="structMoveList.html#o0">move</a>);
01968         <a class="code" href="group__board.html#ga5">board_update_move</a>(board, move);
01969         <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &lt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>) {
01970             bestscore = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -upper, -lower, 0);
01971         } <span class="keywordflow">else</span> {
01972             bestscore = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -lower, 0);
01973         }
01974         bestmove = *move-&gt;<a class="code" href="structMove.html#o0">position</a>;
01975         <span class="keywordflow">if</span> (bestscore &gt; lower) lower = bestscore;
01976         <a class="code" href="group__board.html#ga6">board_restore_move</a>(board, move);
01977 
01978         <span class="comment">/* other moves : try to refute the first/best one */</span>
01979         <span class="keywordflow">for</span> (iter = iter-&gt;<a class="code" href="structMoveList.html#o1">next</a>; lower &lt; upper &amp;&amp; iter != NULL; iter = iter-&gt;<a class="code" href="structMoveList.html#o1">next</a>) {
01980             move = &amp;(iter-&gt;<a class="code" href="structMoveList.html#o0">move</a>);
01981             <a class="code" href="group__board.html#ga5">board_update_move</a>(board, move);
01982             <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &lt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>) {
01983                 score = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -lower - 1, -lower, 0);
01984                 <span class="keywordflow">if</span> (lower &lt; score &amp;&amp; score &lt; upper)
01985                     score = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -upper, -score, 0);
01986             } <span class="keywordflow">else</span> {
01987                 score = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -lower - 1, -lower, 0);
01988                 <span class="keywordflow">if</span> (lower &lt; score &amp;&amp; score &lt; upper)
01989                     score = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -score, 0);
01990             }
01991             <a class="code" href="group__board.html#ga6">board_restore_move</a>(board, move);
01992             <span class="keywordflow">if</span> (score &gt; bestscore) {
01993                 bestscore = score;
01994                 bestmove = *move-&gt;<a class="code" href="structMove.html#o0">position</a>;
01995                 <span class="keywordflow">if</span> (bestscore &gt; lower) lower = bestscore;
01996             }
01997         }
01998     }
01999 <span class="preprocessor">#if USE_HASH_TABLE</span>
02000 <span class="preprocessor"></span>    <a class="code" href="group__hash.html#ga4">hash_update</a>(hash_table, board, alpha, beta, bestscore, bestmove);
02001 <span class="preprocessor">#endif</span>
02002 <span class="preprocessor"></span>
02003     <span class="keywordflow">return</span> bestscore;
02004 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga6" doxytag="solver.c::PVS_root" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void PVS_root </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>board</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structHashTable.html">HashTable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hash_table</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>beta</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structMoveList.html">MoveList</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>movelist</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Principal Variation Search algorithm at the root of the tree. 
<p>
This function solves the position provided within the limits set by the alpha and beta bounds. The movelist parameter is updated so that the bestmove is the first of the list when the search ended.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board. </td></tr>
    <tr><td valign=top><em>hash_table</em>&nbsp;</td><td>hash table to memorize the analysis. </td></tr>
    <tr><td valign=top><em>alpha</em>&nbsp;</td><td>lower bound. </td></tr>
    <tr><td valign=top><em>beta</em>&nbsp;</td><td>upper bound. </td></tr>
    <tr><td valign=top><em>movelist</em>&nbsp;</td><td>List of legal moves (should actually contain moves !). </td></tr>
  </table>
</dl>

<p>
<div class="fragment"><pre>02021 {
02022     <span class="keywordtype">int</span> lower, upper;
02023     <a class="code" href="structMoveList.html">MoveList</a> *iter;
02024     <a class="code" href="structMove.html">Move</a> *move, *bestmove;
02025 
02026     lower = alpha;
02027     upper = beta;
02028     board-&gt;<a class="code" href="structBoard.html#o4">n_nodes</a>++;
02029 
02030     <span class="comment">/* first move */</span>
02031     iter = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>;
02032     bestmove = &amp;(iter-&gt;<a class="code" href="structMoveList.html#o0">move</a>);
02033     <a class="code" href="group__board.html#ga5">board_update_move</a>(board, bestmove);
02034     <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 0) {
02035         bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga1">board_get_final_score_0</a>(board);
02036     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 1) {
02037         bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga2">board_get_final_score_1</a>(board);
02038     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 2) {
02039         bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga3">board_get_final_score_2</a>(board, -upper, -lower, 0);
02040     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &lt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>) {
02041         bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -upper, -lower, 0);
02042     } <span class="keywordflow">else</span> {
02043         bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -lower, 0);
02044     }
02045     <span class="keywordflow">if</span> (bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> &gt; lower) lower = bestmove-&gt;<a class="code" href="structMove.html#o2">score</a>;
02046     <a class="code" href="group__board.html#ga6">board_restore_move</a>(board, bestmove);
02047 
02048     <span class="comment">/* other moves : try to refute the first/best one */</span>
02049     <span class="keywordflow">for</span> (iter = iter-&gt;<a class="code" href="structMoveList.html#o1">next</a>; lower &lt; upper &amp;&amp; iter != NULL; iter = iter-&gt;<a class="code" href="structMoveList.html#o1">next</a>) {
02050         move = &amp;(iter-&gt;<a class="code" href="structMoveList.html#o0">move</a>);
02051         <a class="code" href="group__board.html#ga5">board_update_move</a>(board, move);
02052         <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 0) {
02053             move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga1">board_get_final_score_0</a>(board);
02054         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 1) {
02055             move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga2">board_get_final_score_1</a>(board);
02056         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> == 2) {
02057             move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga3">board_get_final_score_2</a>(board, -upper, -lower, 0);
02058         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &lt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>) {
02059             move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga4">alphabeta_shallow</a>(board, -lower - 1, -lower, 0);
02060             <span class="keywordflow">if</span> (lower &lt; move-&gt;<a class="code" href="structMove.html#o2">score</a> &amp;&amp; move-&gt;<a class="code" href="structMove.html#o2">score</a> &lt; upper)
02061                 move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -move-&gt;<a class="code" href="structMove.html#o2">score</a>, 0);
02062         } <span class="keywordflow">else</span> {
02063             move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -lower - 1, -lower, 0);
02064             <span class="keywordflow">if</span> (lower &lt; move-&gt;<a class="code" href="structMove.html#o2">score</a> &amp;&amp; move-&gt;<a class="code" href="structMove.html#o2">score</a> &lt; upper)
02065                 move-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga5">PVS_deep</a>(board, hash_table, -upper, -move-&gt;<a class="code" href="structMove.html#o2">score</a>, 0);
02066         }
02067         <a class="code" href="group__board.html#ga6">board_restore_move</a>(board, move);
02068         <span class="keywordflow">if</span> (move-&gt;<a class="code" href="structMove.html#o2">score</a> &gt; bestmove-&gt;<a class="code" href="structMove.html#o2">score</a>) {
02069             bestmove = move;
02070             <span class="keywordflow">if</span> (bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> &gt; lower) lower = bestmove-&gt;<a class="code" href="structMove.html#o2">score</a>;
02071         }
02072     }
02073     <a class="code" href="group__move.html#ga2">movelist_sort_bestmove</a>(movelist, *bestmove-&gt;<a class="code" href="structMove.html#o0">position</a>);
02074 <span class="preprocessor">#if USE_HASH_TABLE</span>
02075 <span class="preprocessor"></span>    <a class="code" href="group__hash.html#ga4">hash_update</a>(hash_table, board, alpha, beta, bestmove-&gt;<a class="code" href="structMove.html#o2">score</a>, *bestmove-&gt;<a class="code" href="structMove.html#o0">position</a>);
02076 <span class="preprocessor">#endif</span>
02077 <span class="preprocessor"></span>}
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="ga7" doxytag="solver.c::solve" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void solve </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structBoard.html">Board</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>board</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structHashTable.html">HashTable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hash_table</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structMove.html">Move</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>bestmove</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Search the bestmove of a given board. 
<p>
Depending on the mode, the function will try to solve for a draw (DL_SCORE), a win (WD_SCORE), the exact outcome (WDL_SCORE) or the exact score. For the latter case, aspiration windows have been implemented. Thus, the search does not start with a plain alphabeta window [-INF_SCORE, +INF_SCORE], but with a reduce window [-1, +1] that will just find who is the winner. In case the game outcome is a draw, the search will stop here otherwise another search with a [+1, +8] window for the winner side will start. If the winning score falls within these bounds, the search is stopped else it is restarted with a last window of [+8, +64]. The search is then made within the PVS_root function.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>board</em>&nbsp;</td><td>board to solve. </td></tr>
    <tr><td valign=top><em>hash_table</em>&nbsp;</td><td>hash table to memorize the analysis. </td></tr>
    <tr><td valign=top><em>mode</em>&nbsp;</td><td>search mode: exact or win/draw/loss. </td></tr>
    <tr><td valign=top><em>bestmove</em>&nbsp;</td><td>the bestmove found. </td></tr>
  </table>
</dl>

<p>
<div class="fragment"><pre>02099 {
02100     <span class="keywordtype">int</span> score, bound;
02101     <a class="code" href="structMoveList.html">MoveList</a> movelist[<a class="code" href="group__mac.html#ga23">MAX_MOVE</a> + 2];
02102 
02103     board-&gt;<a class="code" href="structBoard.html#o4">n_nodes</a> = 0;
02104     <a class="code" href="group__board.html#ga9">board_get_movelist</a>(board, movelist);
02105     <span class="keywordflow">if</span> (movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a> != NULL) { <span class="comment">/* normal play ? */</span>
02106         <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &gt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>)
02107             <a class="code" href="group__move.html#ga3">movelist_sort_fastfirst</a>(movelist, board);
02108         <span class="keywordflow">switch</span> (mode) {
02109         <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a137">DL_SCORE</a>:
02110             <span class="comment">/* look for a draw or a loss */</span>
02111             <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1,  0, movelist);
02112             <span class="keywordflow">break</span>;
02113         <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a136">WD_SCORE</a>:
02114             <span class="comment">/* look for a win or a draw */</span>
02115             <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table,  0, +1, movelist);
02116             <span class="keywordflow">break</span>;
02117         <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a135">WDL_SCORE</a>:
02118             <span class="comment">/* look for a win or a draw or a loss */</span>
02119             <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1, +1, movelist);
02120             <span class="keywordflow">break</span>;
02121         <span class="keywordflow">default</span>:
02122             <span class="comment">/* look for the exact best score */</span>
02123             <span class="comment">/* start to look for a win or a draw or a loss */</span>
02124             <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1, +1, movelist);
02125             score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02126             <span class="keywordflow">if</span> (score &gt; 0) {
02127                 <span class="comment">/* if a win look for a score between [+2 +8] */</span>
02128                 bound = score + 8;
02129                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, score, bound, movelist);
02130                 score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02131                 <span class="keywordflow">if</span> (score &gt;= bound) {
02132                     <span class="comment">/* failed -&gt; look for a score between [+8, +64] */</span>
02133                     <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, score, +MAX_SCORE, movelist);
02134                 }
02135             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &lt; 0) {
02136                 <span class="comment">/* if a loss look for a score between [-8 -2] */</span>
02137                 bound = score - 8;
02138                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, bound, score, movelist);
02139                 score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02140                 <span class="keywordflow">if</span> (score &lt;= bound) {
02141                     <span class="comment">/* failed -&gt; look for a score between [-64, -8] */</span>
02142                     <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -MAX_SCORE, score, movelist);
02143                 }
02144             }
02145             <span class="keywordflow">break</span>;
02146         }
02147         *bestmove = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>;
02148     } <span class="keywordflow">else</span> { <span class="comment">/* pass ? */</span>
02149         bestmove-&gt;<a class="code" href="structMove.html#o1">n</a> = 0;
02150         <a class="code" href="group__board.html#ga7">board_update_pass</a>(board);
02151         <a class="code" href="group__board.html#ga9">board_get_movelist</a>(board, movelist);
02152         <span class="keywordflow">if</span> (movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a> == NULL) { <span class="comment">/* game over ? */</span>
02153             bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -<a class="code" href="group__search.html#ga0">board_get_final_score</a>(board);
02154             *bestmove-&gt;<a class="code" href="structMove.html#o0">position</a> = <a class="code" href="group__mac.html#gga56a56">NOMOVE</a>;
02155         } <span class="keywordflow">else</span> {
02156             <span class="keywordflow">if</span> (board-&gt;<a class="code" href="structBoard.html#o3">n_empties</a> &gt; <a class="code" href="group__mac.html#ga12">EMPTIES_DEEP_TO_SHALLOW_SEARCH</a>)
02157                 <a class="code" href="group__move.html#ga3">movelist_sort_fastfirst</a>(movelist, board);
02158             <span class="keywordflow">switch</span> (mode) {
02159             <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a137">DL_SCORE</a>:
02160                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table,  0, +1, movelist);
02161                 <span class="keywordflow">break</span>;
02162             <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a136">WD_SCORE</a>:
02163                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1,  0, movelist);
02164                 <span class="keywordflow">break</span>;
02165             <span class="keywordflow">case</span> <a class="code" href="group__mac.html#gga59a135">WDL_SCORE</a>:
02166                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1, +1, movelist);
02167                 <span class="keywordflow">break</span>;
02168             <span class="keywordflow">default</span>:
02169                 <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -1, +1, movelist);
02170                 score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02171                 <span class="keywordflow">if</span> (score &gt; 0) {
02172                     bound = score + 8;
02173                     <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, score, bound, movelist);
02174                     score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02175                     <span class="keywordflow">if</span> (score &gt;= bound)
02176                         <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, score, +MAX_SCORE, movelist);
02177                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &lt; 0) {
02178                     bound = score - 8;
02179                     <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, bound, score, movelist);
02180                     score = movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02181                     <span class="keywordflow">if</span> (score &lt;= bound)
02182                         <a class="code" href="group__search.html#ga6">PVS_root</a>(board, hash_table, -MAX_SCORE, score, movelist);
02183                 }
02184                 <span class="keywordflow">break</span>;
02185             }
02186             bestmove-&gt;<a class="code" href="structMove.html#o2">score</a> = -movelist-&gt;<a class="code" href="structMoveList.html#o1">next</a>-&gt;<a class="code" href="structMoveList.html#o0">move</a>.<a class="code" href="structMove.html#o2">score</a>;
02187             *bestmove-&gt;<a class="code" href="structMove.html#o0">position</a> = <a class="code" href="group__mac.html#gga56a57">PASS</a>;
02188         }
02189         <a class="code" href="group__board.html#ga8">board_restore_pass</a>(board);
02190     }
02191 }
</pre></div>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 12 19:31:52 2004 for Othello Solver by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
